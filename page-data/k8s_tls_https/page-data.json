{"componentChunkName":"component---src-templates-post-jsx","path":"/k8s_tls_https/","result":{"data":{"site":{"siteMetadata":{"title":"Changmin"}},"markdownRemark":{"id":"e769989b-ef7b-532a-9660-34b2dc0fb201","excerpt":"Prerequisite : 본 글에서 언급되지만, 직접적인 설명은 하지 않는 것들입니다. kubernetes TLS istio 환경 저희 프로젝트는 이미 GKE 내에 istio 관련 설정이 기본적으로 셋팅되어 있습니다. Service Traffic GKE istio service mesh istio ingress gateway kiali 소개 서비스를 실…","html":"<h3 id=\"Prerequisite-\" style=\"position:relative;\"><a href=\"#Prerequisite-\" aria-label=\"Prerequisite  permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Prerequisite :</h3>\n<p>본 글에서 언급되지만, 직접적인 설명은 하지 않는 것들입니다.</p>\n<ul>\n<li>kubernetes</li>\n<li>TLS</li>\n<li>istio</li>\n</ul>\n<h3 id=\"환경\" style=\"position:relative;\"><a href=\"#%ED%99%98%EA%B2%BD\" aria-label=\"환경 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>환경</h3>\n<p>저희 프로젝트는 이미 GKE 내에 istio 관련 설정이 기본적으로 셋팅되어 있습니다.</p>\n<p><img src=\"/static/ezgif.com-video-to-gif-converter%20(1)-874781ad6c17bf6e844a1284aee4dc49.gif\" alt=\"Service Traffic\"></p>\n<ul>\n<li>GKE</li>\n<li>istio service mesh</li>\n<li>istio ingress gateway</li>\n<li>kiali</li>\n</ul>\n<h2 id=\"소개\" style=\"position:relative;\"><a href=\"#%EC%86%8C%EA%B0%9C\" aria-label=\"소개 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>소개</h2>\n<p>서비스를 실제로 배포하고, 사용자들에게 더 안전한 서비스를 보장하기 위해 https 를 사용합니다.\n저희 프로젝트의 end-point는 istio ingress gateway로 연결되어 있습니다. 그렇기에 TLS 설정을 istio ingress gateway에 적용해야 합니다.</p>\n<h2 id=\"Cert-Manager\" style=\"position:relative;\"><a href=\"#Cert-Manager\" aria-label=\"Cert Manager permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Cert Manager</h2>\n<p>cert-manager는 kubernetes 클러스터에서 TLS 인증서의 관리를 자동화해 주는 오픈소스입니다. 이를 통해 인증서의 발급, 갱신 그리고 배포 과정을 자동화하여 보안을 강화하고 운영의 편의성을 높일 수 있습니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/aab33472b561943d0008eff58de03c97/11bd9/image-1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 57.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACBUlEQVR42n1SW4/SQBjlpxlf/A/uA79gf4GJ8UGTJfFhE6Ix0Rjf1ahZ3bgiaNzltq5GZOkCkVLo0lKm3Hph2jLtcaYEMLvgSb5k5vQ757tME/gHUQR0uwYkSYFUV1Fv9jCjAa5CNyaQ6x3UeF7zTx+WTVf6hG3b8SUMQ0RhhJZC8PN3G5VqiydrGBALua8/UCxLKJ020O4QGIMpWtywWmvzHGNlGHJ9IgwZ3JmHQukc+aKE43wV51I3LsBrglIfqjqI47JHMJ64EBqB6XCKX8UKCuU6TgoSWrKBhPjAWIjR2MaQJ+h9k58tsDmLecbYegI+kwjBiTulHszBiE8xibWu6y0MN2HRIUDIGLlcGd+Oz5DNlVCpNGLTZYGr2GoouhMQBrd37mB3dw/J5F2kUi9W+9rgt91w/fIMQUDheSJmmM/9eLfbkFgLIy7wuSDg3UX8ZYc4+GDi/aGBdwcEjaaDk/wEH48Isl/MmGsr7up3uWYodkIIgWVN4fsM6UcqUg8vkX6s4979Lj59Jnj2XMd+WsOTp3082Ovi+9l0Nf7GkZevJxKI6UHTXPR6NjTdheMEnPPR7894ONA5R+n8/zuUZRmKIsdnT32LSfYmzMwt0PIOwrkHX32NUebGgjtNcs5ZLmx7h4wtqgbjC1DlFWjnDQLtKBYF4xpm7ZcLTs9wil3r8C+96oUzy4V+ZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='cert-manager' title='' src='/static/aab33472b561943d0008eff58de03c97/ca1dc/image-1.png' srcset='/static/aab33472b561943d0008eff58de03c97/e7570/image-1.png 170w,\n/static/aab33472b561943d0008eff58de03c97/f46e7/image-1.png 340w,\n/static/aab33472b561943d0008eff58de03c97/ca1dc/image-1.png 680w,\n/static/aab33472b561943d0008eff58de03c97/02d09/image-1.png 1020w,\n/static/aab33472b561943d0008eff58de03c97/9d567/image-1.png 1360w,\n/static/aab33472b561943d0008eff58de03c97/11bd9/image-1.png 1420w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>cert-manager</figcaption>\n  </figure></p>\n<p>cert manager는 다양한 CA와 연동할 수 있는데, 저희 서비스 설정에서는 Let`s Encrypt를 사용했습니다.</p>\n<h3 id=\"설정-과정\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95\" aria-label=\"설정 과정 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>설정 과정</h3>\n<h4 id=\"install-cert-manager\" style=\"position:relative;\"><a href=\"#install-cert-manager\" aria-label=\"install cert manager permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>install cert-manager</h4>\n<p><code> kubectl apply -f <a href=\"https://github.com/jetstack/cert-manager/releases/download/v1.1.0/cert-manager.yaml\">https://github.com/jetstack/cert-manager/releases/download/v1.1.0/cert-manager.yaml</a> </code></p>\n<p>해당 명령어를 통해 cert-manager를 설치합니다.</p>\n<p>저는 cert-manager-cainjector pod가 Kubernetes API 버전 호환성 문제로 인해 crash가 발생했는데, cert-manager의 버전을 v1.13.0 을 지정하여 설치했습니다.</p>\n<h4 id=\"ClusterIssuer-리소스-생성\" style=\"position:relative;\"><a href=\"#ClusterIssuer-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%83%9D%EC%84%B1\" aria-label=\"ClusterIssuer 리소스 생성 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>ClusterIssuer 리소스 생성</h4>\n<div class=\"gatsby-highlight\" data-language=\"zsh\"><pre class=\"language-zsh\"><code class=\"language-zsh\">kkubectl apply -f - &lt;&lt;EOF\n#prod\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-prod-istio\nspec:\n  acme:\n    server: https://acme-v02.api.letsencrypt.org/directory\n    email: your email\n    privateKeySecretRef:\n      name: letsencrypt-prod-istio\n    solvers:\n    - http01:\n        ingress:\n          class: istio\n---\n#staging\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-staging-istio\nspec:\n  acme:\n    server: https://acme-staging-v02.api.letsencrypt.org/directory\n    email: your email\n    privateKeySecretRef:\n      name: letsencrypt-staging-istio\n    solvers:\n    - http01:\n        ingress:\n          class: istio\nEOF\nclusterissuer.cert-manager.io/letsencrypt-prod-istio created\nclusterissuer.cert-manager.io/letsencrypt-staging-istio created</code></pre></div>\n<p>이 설정은 cert-manager를 사용하여 Let`s Encrypt로부터 TLS 인증서를 발급하는 리소스를 생성합니다. 해당 설정을 통해 클러스터 내에서 자동으로 인증서를 발급받고 갱신할 수 있게 됩니다.</p>\n<blockquote>\n<p>두 개의 ClusterIssuer 리소스 생성</p>\n<ul>\n<li>letsencrypt-prod-istio: Let’s Encrypt의 프로덕션 환경을 사용하여 실제 서비스에서 신뢰할 수 있는 인증서를 발급받기 위한 ClusterIssuer입니다.</li>\n<li>letsencrypt-staging-istio: Let’s Encrypt의 스테이징 환경을 사용하여 테스트 목적으로 인증서를 발급받기 위한 ClusterIssuer입니다. 이 환경에서 발급된 인증서는 브라우저에서 신뢰하지 않으며, 발급 제한 없이 테스트할 수 있습니다.</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>설정의 목적과 역할</p>\n<ol>\n<li>Let’s Encrypt와의 연동을 위한 ClusterIssuer 생성\n• cert-manager가 Let’s Encrypt를 통해 TLS 인증서를 발급받을 수 있도록 설정합니다.\n• 두 개의 ClusterIssuer를 생성하여 테스트 환경과 실제 서비스 환경에서 모두 인증서를 발급받을 수 있습니다.</li>\n<li>ACME 프로토콜을 통한 인증서 발급 자동화\n• ACME(Automatic Certificate Management Environment) 프로토콜을 사용하여 도메인 소유권을 자동으로 검증하고 인증서를 발급받습니다.\n• cert-manager는 ACME 프로토콜을 구현하여 Let’s Encrypt와 통신합니다.</li>\n<li>Istio Ingress Gateway와의 통합\n• ingress.class: istio 설정을 통해 HTTP-01 챌린지를 처리할 때 Istio Ingress Gateway를 사용하도록 지정합니다.\n• 이를 통해 도메인 검증 요청이 Istio Ingress Gateway를 통해 cert-manager로 전달됩니다.</li>\n</ol>\n</blockquote>\n<h4 id=\"Certificate-리소스-생성\" style=\"position:relative;\"><a href=\"#Certificate-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%83%9D%EC%84%B1\" aria-label=\"Certificate 리소스 생성 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Certificate 리소스 생성</h4>\n<p>certificate.yaml 파일을 작성하여 원하는 도메인에 대한 TLS 인증서를 요청합니다.</p>\n<ol>\n<li>certificate.yaml 파일 작성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> cert<span class=\"token punctuation\">-</span>manager.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Certificate\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>system\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n  <span class=\"token key atrule\">issuerRef</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> letsencrypt<span class=\"token punctuation\">-</span>prod<span class=\"token punctuation\">-</span>istio <span class=\"token comment\"># 이전에 생성한 ClusterIssuer 이름</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterIssuer\n  <span class=\"token key atrule\">commonName</span><span class=\"token punctuation\">:</span> your.domain.name <span class=\"token comment\"># 실제 도메인 이름으로 변경</span>\n  <span class=\"token key atrule\">dnsNames</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> your.domain.name <span class=\"token comment\"># 실제 도메인 이름으로 변경</span></code></pre></div>\n<ol start=\"2\">\n<li>certificate.yaml 파일 적용</li>\n</ol>\n<p><code> kubectl apply -f certificate.yaml </code></p>\n<p>이 명령어를 실행하여 Certificate 리소스를 클러스터에 적용합니다. cert-manager는 이 리소스를 감지하고, 지정된 ClusterIssuer를 통해 인증서를 발급받기 시작합니다.</p>\n<h4 id=\"인증서-발급-상태-확인\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89-%EC%83%81%ED%83%9C-%ED%99%95%EC%9D%B8\" aria-label=\"인증서 발급 상태 확인 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>인증서 발급 상태 확인</h4>\n<p><code> kubectl describe certificate istio-ingressgateway-certs -n istio-system </code></p>\n<p>위의 명령어를 입력하게 되면 아래와 같은 정보가 나오게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"zsh\"><pre class=\"language-zsh\"><code class=\"language-zsh\">Name:         istio-ingressgateway-certs\nNamespace:    istio-system\nLabels:       &lt;none&gt;\nAnnotations:  &lt;none&gt;\nAPI Version:  cert-manager.io/v1\nKind:         Certificate\nMetadata:\n  Creation Timestamp:  2024-11-26T13:48:49Z\n  Generation:          1\n  Resource Version:    1367115\n  UID:                 uuid\nSpec:\n  Common Name:  dns name\n  Dns Names:\n    dns name\n  Issuer Ref:\n    Kind:       ClusterIssuer\n    Name:       letsencrypt-prod-istio\n  Secret Name:  istio-ingressgateway-certs\nStatus:\n  Conditions:\n    Last Transition Time:  2024-11-26T14:08:12Z\n    Message:               Certificate is up to date and has not expired\n    Observed Generation:   1\n    Reason:                Ready\n    Status:                True\n    Type:                  Ready\n  Not After:               2025-02-24T13:09:40Z\n  Not Before:              2024-11-26T13:09:41Z\n  Renewal Time:            2025-01-25T13:09:40Z\n  Revision:                1\nEvents:                    &lt;none&gt;</code></pre></div>\n<p>전체적인 의미로는</p>\n<p>인증서 발급 상태</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">•\tReady 상태이며, 인증서가 정상적으로 발급되어 사용 중임을 나타냅니다.\n•\tMessage에서 “Certificate is up to date and has not expired”라고 되어 있으므로, 인증서가 최신 상태입니다.</code></pre></div>\n<p>인증서의 유효 기간</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">•\tNot Before: 2024-11-26T13:09:41Z\n•\t인증서의 유효 시작일입니다.\n•\tNot After: 2025-02-24T13:09:40Z\n•\t인증서의 만료일로, 약 3개월의 유효 기간을 가집니다. Let’s Encrypt 인증서는 일반적으로 90일의 유효 기간을 갖습니다.\n•\tRenewal Time: 2025-01-25T13:09:40Z\n•\tcert-manager는 이 시점 전에 인증서를 자동으로 갱신합니다. 일반적으로 만료일의 30일 전에 갱신을 시작합니다.</code></pre></div>\n<p>인증서의 발급자</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">•\tIssuer Ref에서 Kind가 ClusterIssuer이고 Name이 letsencrypt-prod-istio이므로, 이 인증서는 Let’s Encrypt 프로덕션 환경을 사용하여 발급되었습니다.</code></pre></div>\n<p>인증서의 대상 도메인</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">•\tCommon Name과 DNS Names에 dns name이 설정되어 있습니다.\n•\t이 인증서는 dns name 도메인에 대해 발급되었습니다.</code></pre></div>\n<p>인증서의 저장 위치</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">•\t발급된 인증서와 개인 키는 istio-ingressgateway-certs라는 이름의 Secret에 저장됩니다.\n•\t이 Secret은 istio-system 네임스페이스에 존재하며, Istio Ingress Gateway에서 참조하여 TLS 통신에 사용됩니다.</code></pre></div>\n<h2 id=\"istio-ingress-gateway-설정\" style=\"position:relative;\"><a href=\"#istio-ingress-gateway-%EC%84%A4%EC%A0%95\" aria-label=\"istio ingress gateway 설정 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>istio ingress gateway 설정</h2>\n<p>여기까지 왔다면, Kubernetes 클러스터 내에서 자동으로 TLS 인증서를 관리하는 설정까지 완료했습니다.</p>\n<p>그 다음으로는 Istio Ingress Gateway에 인증서를 적용하고, HTTPS 설정을 진행해야 합니다. 이를 통해 외부에서 들어오는 트래픽에 대해 안전한 통신을 보장할 수 있습니다.</p>\n<h3 id=\"설정-과정-1\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95-1\" aria-label=\"설정 과정 1 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>설정 과정</h3>\n<h4 id=\"Istio-Ingress-Gateway에-인증서-적용\" style=\"position:relative;\"><a href=\"#Istio-Ingress-Gateway%EC%97%90-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%A0%81%EC%9A%A9\" aria-label=\"Istio Ingress Gateway에 인증서 적용 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Istio Ingress Gateway에 인증서 적용</h4>\n<p>Istio Ingress Gateway가 발급된 TLS 인증서를 사용하도록 설정하려면, 인증서가 저장된 Secret을 Gateway에 마운트해야 합니다.</p>\n<p>1.1 Istio Ingress Gateway 디플로이먼트 수정</p>\n<p>먼저, Istio Ingress Gateway의 Deployment를 수정하여 인증서 Secret을 마운트합니다.</p>\n<p><code> kubectl edit deployment istio-ingressgateway -n istio-system </code></p>\n<p>위 명령어를 실행하면 기본 에디터에서 Deployment의 YAML 파일이 열립니다. 여기서 다음과 같이 수정합니다.</p>\n<p>volumes 섹션 추가</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n<span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n<span class=\"token key atrule\">optional</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>volumeMounts 섹션 수정</p>\n<p>containers 섹션 아래의 volumeMounts에 다음 내용을 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>proxy <span class=\"token comment\"># Istio Ingress Gateway의 컨테이너 이름입니다.</span>\n    <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/istio/ingressgateway<span class=\"token punctuation\">-</span>certs\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n        <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>전체 예시:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>system\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n          <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n            <span class=\"token key atrule\">optional</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>proxy\n        <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/istio/ingressgateway<span class=\"token punctuation\">-</span>certs\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs\n            <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># 나머지 설정들은 기존 내용 유지</span></code></pre></div>\n<p>변경 사항을 저장하면 Kubernetes는 Deployment의 변경을 감지하고 Istio Ingress Gateway 파드를 재시작하여 새로운 설정을 적용합니다.</p>\n<h4 id=\"Istio-Ingress-Gateway-서비스의-포트-확인\" style=\"position:relative;\"><a href=\"#Istio-Ingress-Gateway-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%9D%98-%ED%8F%AC%ED%8A%B8-%ED%99%95%EC%9D%B8\" aria-label=\"Istio Ingress Gateway 서비스의 포트 확인 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Istio Ingress Gateway 서비스의 포트 확인</h4>\n<p>Istio Ingress Gateway 서비스에서 HTTPS를 위한 포트가 올바르게 설정되어 있는지 확인합니다.</p>\n<p><code>kubectl get svc istio-ingressgateway -n istio-system</code></p>\n<p>출력 결과에서 PORT(S) 열에 443 포트가 포함되어 있어야 합니다.</p>\n<p>예시:</p>\n<div class=\"gatsby-highlight\" data-language=\"zsh\"><pre class=\"language-zsh\"><code class=\"language-zsh\">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE\nistio-ingressgateway LoadBalancer 10.100.200.1 34.123.45.67 15021/TCP,80/TCP,443/TCP,15443/TCP,15012/TCP,15017/TCP 2d</code></pre></div>\n<p>만약 443 포트가 없거나 다른 포트로 설정되어 있다면, 다음과 같이 서비스의 설정을 수정합니다.</p>\n<p><code>kubectl edit svc istio-ingressgateway -n istio-system</code></p>\n<p>ports 섹션에 다음 내용을 추가하거나 수정합니다.</p>\n<p>ports:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https\n  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span>\n  <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8443</span>\n  <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</code></pre></div>\n<h4 id=\"Gateway-및-VirtualService-설정\" style=\"position:relative;\"><a href=\"#Gateway-%EB%B0%8F-VirtualService-%EC%84%A4%EC%A0%95\" aria-label=\"Gateway 및 VirtualService 설정 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Gateway 및 VirtualService 설정</h4>\n<p>이제 Istio의 Gateway 및 VirtualService 리소스를 생성하여 Istio Ingress Gateway가 HTTPS 요청을 처리하고 적절한 서비스로 라우팅하도록 설정합니다.</p>\n<p>Gateway 리소스 생성</p>\n<p>gateway.yaml 파일을 생성하고 다음과 같이 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Gateway\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>gateway\n<span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> your<span class=\"token punctuation\">-</span>namespace <span class=\"token comment\"># 실제 네임스페이스로 변경</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">istio</span><span class=\"token punctuation\">:</span> ingressgateway <span class=\"token comment\"># Istio Ingress Gateway를 선택</span>\n<span class=\"token key atrule\">servers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https\n    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> HTTPS\n    <span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> SIMPLE\n    <span class=\"token key atrule\">credentialName</span><span class=\"token punctuation\">:</span> istio<span class=\"token punctuation\">-</span>ingressgateway<span class=\"token punctuation\">-</span>certs <span class=\"token comment\"># Secret의 이름과 일치해야 함</span>\n    <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"your.domain.com\"</span> <span class=\"token comment\"># 실제 도메인 이름으로 변경</span></code></pre></div>\n<p>적용하기:</p>\n<p><code>kubectl apply -f gateway.yaml</code></p>\n<p>VirtualService 리소스 생성</p>\n<p>virtualservice.yaml 파일을 생성하고 다음과 같이 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.istio.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> VirtualService\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>virtualservice\n<span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> your<span class=\"token punctuation\">-</span>namespace <span class=\"token comment\"># 실제 네임스페이스로 변경</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token punctuation\">-</span> <span class=\"token string\">\"your.domain.com\"</span> <span class=\"token comment\"># 실제 도메인 이름으로 변경</span>\n  <span class=\"token key atrule\">gateways</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> my<span class=\"token punctuation\">-</span>gateway\n  <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">match</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">prefix</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/\"</span> <span class=\"token comment\"># 모든 요청 매칭</span>\n    <span class=\"token key atrule\">route</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> your<span class=\"token punctuation\">-</span>service <span class=\"token comment\"># 실제 서비스의 이름으로 변경</span>\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span> <span class=\"token comment\"># 서비스의 포트 번호로 변경</span></code></pre></div>\n<p>적용하기:</p>\n<p><code>kubectl apply -f virtualservice.yaml</code></p>\n<h2 id=\"DNS-설정-확인-및-업데이트\" style=\"position:relative;\"><a href=\"#DNS-%EC%84%A4%EC%A0%95-%ED%99%95%EC%9D%B8-%EB%B0%8F-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"DNS 설정 확인 및 업데이트 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>DNS 설정 확인 및 업데이트</h2>\n<p>도메인 이름이 Istio Ingress Gateway의 외부 IP 주소를 가리키도록 DNS 설정을 확인하고 필요하다면 업데이트합니다.</p>\n<h3 id=\"설정-과정-2\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95-2\" aria-label=\"설정 과정 2 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>설정 과정</h3>\n<h4 id=\"Istio-Ingress-Gateway의-외부-IP-확인\" style=\"position:relative;\"><a href=\"#Istio-Ingress-Gateway%EC%9D%98-%EC%99%B8%EB%B6%80-IP-%ED%99%95%EC%9D%B8\" aria-label=\"Istio Ingress Gateway의 외부 IP 확인 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Istio Ingress Gateway의 외부 IP 확인</h4>\n<p><code>kubectl get svc istio-ingressgateway -n istio-system</code></p>\n<p>출력 결과에서 EXTERNAL-IP 열에 표시된 IP 주소를 확인합니다.</p>\n<h4 id=\"DNS-레코드-업데이트\" style=\"position:relative;\"><a href=\"#DNS-%EB%A0%88%EC%BD%94%EB%93%9C-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"DNS 레코드 업데이트 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>DNS 레코드 업데이트</h4>\n<p>DNS 제공자의 관리 콘솔에서 해당 도메인의 A 레코드를 Istio Ingress Gateway의 외부 IP 주소로 설정합니다.</p>\n<h4 id=\"HTTPS-연결-테스트\" style=\"position:relative;\"><a href=\"#HTTPS-%EC%97%B0%EA%B2%B0-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"HTTPS 연결 테스트 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>HTTPS 연결 테스트</h4>\n<p>설정이 완료되면 HTTPS 연결이 정상적으로 동작하는지 테스트합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"zsh\"><pre class=\"language-zsh\"><code class=\"language-zsh\">curl -vk https://your.domain.com</code></pre></div>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>마무리</h2>\n<p>이렇게해서 Istio Ingress Gateway에 TLS 인증서를 적용하고, HTTPS 설정을 진행해보았습니다. 이제 외부 클라이언트는 안전하게 HTTPS를 통해 서비스에 접근할 수 있습니다.</p>\n<p>추가적으로, 내부 서비스 간 통신에 대해 mTLS를 적용하여 클러스터 내 보안을 강화할 수도 있습니다.</p>\n<h3 id=\"참고-자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\"참고 자료 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>참고 자료</h3>\n<p><a href=\"https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress/\">Istio 공식 문서 - TLS 설정</a></p>\n<p><a href=\"https://cert-manager.io/docs/\">cert-manager 공식 문서</a></p>","frontmatter":{"title":"k8s와 istio에 TLS 적용하기","date":"November 27, 2024","update":null,"tags":["MSA","istio","TLS","https"],"series":"주니어 백엔드 개발자의 MSA 개발기"},"fields":{"slug":"/k8s_tls_https/","readingTime":{"minutes":13.15}}},"seriesList":{"edges":[{"node":{"id":"485c2f04-1c1c-5cf4-8b13-183470601dc9","fields":{"slug":"/msa-01/"},"frontmatter":{"title":"모니터링 vs 옵저버빌리티"}}},{"node":{"id":"2c5cde8f-8444-5afa-8e7f-4d0dfa070e28","fields":{"slug":"/istio-srping-cloud-gateway/"},"frontmatter":{"title":"istio Ingress Gateway와 Spring Cloud Gateway 사용하기"}}},{"node":{"id":"e769989b-ef7b-532a-9660-34b2dc0fb201","fields":{"slug":"/k8s_tls_https/"},"frontmatter":{"title":"k8s와 istio에 TLS 적용하기"}}}]},"previous":{"fields":{"slug":"/jvm_12/"},"frontmatter":{"title":"JVM 12.1~12.4"}},"next":null},"pageContext":{"id":"e769989b-ef7b-532a-9660-34b2dc0fb201","series":"주니어 백엔드 개발자의 MSA 개발기","previousPostId":"eb82b812-1e72-5dc6-8e49-336d7ccce2a9","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}