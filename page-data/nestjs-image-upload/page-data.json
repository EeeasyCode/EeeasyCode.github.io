{"componentChunkName":"component---src-templates-post-jsx","path":"/nestjs-image-upload/","result":{"data":{"site":{"siteMetadata":{"title":"Changmin"}},"markdownRemark":{"id":"9319ba96-8eeb-514a-9e28-2093442bb37b","excerpt":"Feature Image Upload 서버에서 Sharp 라이브러리를 사용해 Content-type 변경하는 기능 구현 Situation 기존 운영중인 서비스은 S3에 이미지 업로드 할 때, image/jpg로 업로드됩니다.\nJPG는 PNG에 비해 작은 용량의 크기로 사진을 압축할 수 있지만 WebP와 비교했을 때 화질면에서 크게 떨어집니다.\n또한, We…","html":"<h1 id=\"Feature\" style=\"position:relative;\"><a href=\"#Feature\" aria-label=\"Feature permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Feature</h1>\n<p>Image Upload 서버에서 Sharp 라이브러리를 사용해 Content-type 변경하는 기능 구현</p>\n<h2 id=\"Situation\" style=\"position:relative;\"><a href=\"#Situation\" aria-label=\"Situation permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Situation</h2>\n<p>기존 운영중인 서비스은 S3에 이미지 업로드 할 때, image/jpg로 업로드됩니다.\nJPG는 PNG에 비해 작은 용량의 크기로 사진을 압축할 수 있지만 WebP와 비교했을 때 화질면에서 크게 떨어집니다.\n또한, Webp는 PNG에 비해 크기가 26%, JPEG 이미지보다 25~34% 더 작습니다.</p>\n<blockquote>\n<p>출처 : <a href=\"https://developers.google.com/speed/webp?hl=ko\">https://developers.google.com/speed/webp?hl=ko</a></p>\n</blockquote>\n<h2 id=\"Task\" style=\"position:relative;\"><a href=\"#Task\" aria-label=\"Task permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Task</h2>\n<ul>\n<li>업로드 할 이미지의 용량 축소 기능 구현</li>\n<li>Sharp 라이브러리를 활용하여 이미지의 Content-Type을 image/webp 로 변환</li>\n</ul>\n<h2 id=\"Action\" style=\"position:relative;\"><a href=\"#Action\" aria-label=\"Action permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Action</h2>\n<ul>\n<li>이미지 업로드 API의 서비스 로직에 Sharp 라이브러리로 Image의 Buffer를 webp로 변환</li>\n<li>이미지 파일의 확장자를 .webp로 변환</li>\n<li>S3 업로드 시, ContentType을 image/webp로 설정</li>\n</ul>\n<h2 id=\"Result\" style=\"position:relative;\"><a href=\"#Result\" aria-label=\"Result permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Result</h2>\n<p>테스트 결과 -> 파일 A, 파일 B</p>\n<blockquote>\n<p>png 파일 업로드 -> 131.2 KB, 333.5 KB <br>\njpeg 파일 업로드 -> 86.0 KB, 241.8 KB <br> > <strong>webp 파일 업로드 -> 50.9 KB, 128.2 KB</strong> <br></p>\n</blockquote>\n<p>로 webp 변환 시 저장 공간에 대한 효율성을 향상시킬 수 있습니다.\n이는 업로드에 대한 성능 뿐만 아니라, 실제 클라이언트에게 이미지 파일이 전달될 때에 확실한 성능 차이가 보여질 것으로 판단됩니다.</p>\n<img width='1157' alt='upload_test' src='https://github.com/EeeasyCode/nest-study/assets/92606611/e605cf3b-8069-44bd-922d-dc6e3e5d9235'>","frontmatter":{"title":"이미지 업로드 성능 개선","date":"April 03, 2024","update":"April 03, 2024","tags":["NestJS","성능개선"],"series":"NestJS"},"fields":{"slug":"/nestjs-image-upload/","readingTime":{"minutes":1.765}}},"seriesList":{"edges":[{"node":{"id":"9319ba96-8eeb-514a-9e28-2093442bb37b","fields":{"slug":"/nestjs-image-upload/"},"frontmatter":{"title":"이미지 업로드 성능 개선"}}},{"node":{"id":"a4992445-f0ed-5431-895f-704ae4c53bcd","fields":{"slug":"/typeorm-join/"},"frontmatter":{"title":"연관관계 없이 join"}}},{"node":{"id":"f169a0b9-a08f-5318-bf78-cd6de2b2a188","fields":{"slug":"/nestjs-build-time/"},"frontmatter":{"title":"NestJS 빌드 속도 개선"}}},{"node":{"id":"d135f890-7d1e-510e-9361-82592c539380","fields":{"slug":"/toss-aop-review/"},"frontmatter":{"title":"TOSS AOP 라이브러리"}}},{"node":{"id":"68c77c5b-0823-54f4-8644-a78173f1ba2e","fields":{"slug":"/nestjs-interface-di/"},"frontmatter":{"title":"NestJS에서 인터페이스 DI"}}}]},"previous":{"fields":{"slug":"/github-slack-bot/"},"frontmatter":{"title":"PR 리뷰어 할당 봇 만들기"}},"next":{"fields":{"slug":"/typeorm-join/"},"frontmatter":{"title":"연관관계 없이 join"}}},"pageContext":{"id":"9319ba96-8eeb-514a-9e28-2093442bb37b","series":"NestJS","previousPostId":"a62e9cd4-1132-54c4-bec0-3234b743da78","nextPostId":"a4992445-f0ed-5431-895f-704ae4c53bcd"}},"staticQueryHashes":[],"slicesMap":{}}